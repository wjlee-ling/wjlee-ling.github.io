# Word2Vec
> "CS224n: Word2Vec과 a2과제 풀이"
- toc: true
- badges: true
- comments: true
- date: 2022-06-02
- categories: [TIL, cs224n]


```python
#collapse-hide
# colab에서 실행할 시 준비과정
%cd "/content/drive/MyDrive/Colab Notebooks/nlp/a2/"
```

    /content/drive/MyDrive/Colab Notebooks/nlp/a2



```python
#hide
#dataset 다운로드
!bash get_datasets.sh
```

Word2Vec은 구글의 Mikolov가 제안한 word embedding 방식으로 기존의 통계적인 임베딩 방식 (e.g.  tf-idf)과 달리 딥러닝 기반 임베딩으로 유의미한 성과를 냈다. Word2Vec의 Bag-of-Words 모델로 이는 단어의 어순 상관없이 어휘 빈도를 고려하는 방법을 말한다. Word2Vec은 skipgram, cbow라는 두가지 훈련 방법을 제시했다.

* reference
1. [Efficient Estimation of Word Representations in
Vector Space
](https://arxiv.org/pdf/1301.3781.pdf)

## CBOW 
![image.png](data:image/png;base64,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)

**CBOW(Continuous Bag-of-Words)**는 주어진 winodw내 고정된 수의 context words로(정확히 말해 해당 벡터들의 평균값으로) target word(중간 단어)를 맞추는 훈련 방식이다. 타겟 단어들은 모두 같은 weight를 공유한다. 


## Skip-gram 

**Skipgram**은 CBOW와 정반대로 타겟 단어를 바탕으로 정해진 수의 앞뒤 단어들을 맞추는 모델이다. CBOW모다 훈련은 느리지만, 보다 적은 훈련 데이터 양으로도 좋은 성과를 내며, 빈도가 적은 단어도 보다 잘 표현한다고 한다. (그 이유는 CBOW는 1. 벡터의 평균을 내고 2. 타겟 단어 하나만 예측하기 때문에 아무래도 빈도가 높은 단어 위주로 예측하게 되기 때문에...?) 
그래서 그런지 보통 skipgram으로 구현하는 경우가 많은 듯 하다.

사전(10,000 단어)의 각 단어($w$)마다 target(중앙) 단어일 때의 벡터 $V_w$와 context 단어일 때의 벡터($U_w$)를 갖는다 ($V_w, U_w \in \mathbb{R^{300}} $). 현재 단어가 $C$일 때, $C$가 아닌 단어 $O$가 $C$의 앞뒤로 나타날 확률은 다음과 같이 정의한다.
$$
P(O | C) = \frac{exp({U_O}^\top V_C)}{\sum_{w}exp({U_w}^\top V_C)}
$$
즉 $U_O$, $V_C$의 내적(분자)을 통해 단어 O, C의 유사도를 구하고 이를 사전 전체를 두고 정규화(분모)한다.

따라서 각 위치를 $t$라고 할 때 우도(likelihood)는
$$
𝐿(\theta) = \prod_{t}^{T}\prod_{-m \leq j \leq m}{P(W_{t+j} \mid W_t ; \theta)} \space (j \ne 0, m은\ context\ size)
$$
이고 모델 전체의 cost는 negative log-likelilhood로서
$$
J(\theta) = - \frac{1}{T}\log𝐿(\theta)= - \frac{1}{T}\sum_{t}\sum_{j}\log{P(W_{t+j} \mid W_t ; \theta)}
$$
이다. (다만 위는 batch gradient descent임. 실제로는 대부분 SGD로 구현). Skipgram은 이 평균 로그 확률값을 줄이는 방향으로 훈련을 하게 된다.

> Note: 우도를 극대화 할수록 우도에 minus 씌운 cost는 극소화 된다.



## Skip-gram의 목적함수

### softmax loss (categorical cross-entropy loss)

현재 타겟 단어 (=center 단어) $C$에 context로 단어 $O$가 나타날 확률에다가 log를 씌운 값이 $\log{P(O \mid C)}$이고, 이 때 $U_O, V_C$ 각각에 대해 미분값을 구하자면

$$
\frac{\partial}{\partial V_C}\log P(O \mid C) = \frac{\partial}{\partial V_C}\log\frac{exp({U_O}^\top V_C)}{\sum_{w}exp({U_w}^\top V_C)} \\
=  \frac{\partial}{\partial V_C}[{U_O}^\top V_C - \log \sum_{w}exp({U_w}^\top V_C)] \\
= U_O - \frac{1}{\sum_{w}exp({U_w}^\top V_C)} \frac{\partial}{\partial V_C}\sum_{w}exp({U_w}^\top V_C) \\
= U_O - \frac{1}{\sum_{w}exp({U_w}^\top V_C)}\sum_{w}exp({U_w}^\top V_C)U_w \\
= U_O -\sum_{w}{\frac{exp({U_w}^\top V_C)}{\sum_{w}exp({U_w}^\top V_C)}U_w} \\
= U_O - \sum_{w}P(w \mid C)U_w \\
\frac{\partial}{\partial U_O}\log P(O \mid C) =\frac{\partial}{\partial U_O}
\log\frac{exp({U_O}^\top V_C)}{\sum_{w}exp({U_w}^\top V_C)} \\
= \frac{\partial}{\partial U_O}{U_O}^\top V_C - \frac{\partial}{\partial U_O}\log\sum_{w}exp({U_w}^\top V_C) \\
= V_C - \frac{1}{\sum_{w}exp({U_w}^\top V_C)} \cdot \frac{\partial}{\partial U_O}[exp({U_1}^\top V_C) + \cdots+exp({U_O}^\top V_C)] \\
= V_C - \frac{1}{\sum_{w}exp({U_w}^\top V_C)} \cdot exp({U_O}^\top V_C) \cdot V_C \\
= V_C - \frac{exp({U_O}^\top V_C) }{\sum_{w}exp({U_w}^\top V_C)}\cdot V_C = V_C - P(O \mid C) \cdot V_C
$$

error 값은 역시 위 log-likelihood 미분값의 음수값이므로

$$
\frac{\partial}{\partial V_C}J(\theta;O,C) = - \frac{\partial}{\partial V_C}\log{P(O \mid C)} =\sum_{w}P(w \mid C)U_w - U_O \\
\frac{\partial}{\partial U_O}J(\theta;O,C) = - \frac{\partial}{\partial U_O}\log{P(O \mid C)} = P(O \mid C) \cdot V_C - V_C
$$




```python
# collapse-show
# word2vec.py
def naiveSoftmaxLossAndGradient(
    centerWordVec,
    outsideWordIdx,
    outsideVectors,
    dataset
):
    """ Naive Softmax loss & gradient function for word2vec models

    Implement the naive softmax loss and gradients between a center word's 
    embedding and an outside word's embedding. This will be the building block
    for our word2vec models. For those unfamiliar with numpy notation, note 
    that a numpy ndarray with a shape of (x, ) is a one-dimensional array, which
    you can effectively treat as a vector with length x.

    Arguments:
    centerWordVec -- numpy ndarray, center word's embedding
                    in shape (word vector length, )
                    (v_c in the pdf handout)
    outsideWordIdx -- integer, the index of the outside word
                    (o of u_o in the pdf handout)
    outsideVectors -- outside vectors is
                    in shape (num words in vocab, word vector length) 
                    for all words in vocab (tranpose of U in the pdf handout)
    dataset -- needed for negative sampling, unused here.

    Return:
    loss -- naive softmax loss
    gradCenterVec -- the gradient with respect to the center word vector
                     in shape (word vector length, )
                     (dJ / dv_c in the pdf handout)
    gradOutsideVecs -- the gradient with respect to all the outside word vectors
                    in shape (num words in vocab, word vector length) 
                    (dJ / dU)
    """

    ### YOUR CODE HERE (~6-8 Lines)

    ### Please use the provided softmax function (imported earlier in this file)
    ### This numerically stable implementation helps you avoid issues pertaining
    ### to integer overflow. 

    inner = np.dot(outsideVectors, centerWordVec) # (N,D) @ (D,) -> (N,)
    prob = softmax(inner)[:, np.newaxis] # (N,) -> (N,1)

    loss = - np.log(prob[outsideWordIdx])

    outsideVector = outsideVectors[outsideWordIdx]
    gradCenterVec = np.sum(outsideVectors * prob, axis=0) - outsideVector

    gradOutsideVecs = np.dot(prob, centerWordVec[:, np.newaxis].T)
    gradOutsideVecs[outsideWordIdx] -= centerWordVec
    ### END YOUR CODE

    return loss, gradCenterVec, gradOutsideVecs
```

> Note: colab상에서 코드 돌릴 때 함수를 제대로 짰는지 보려면 아래처럼 '[pyfile명] [fn이름]' 하면 된다 (과제 출제자가 만들어놓음). 대신 맨위에서 한대로 현재 a2 디렉토리여야 함. 

```
!python word2vec.py naiveSoftmaxLossAndGradient
```




```python
#hide
!python word2vec.py naiveSoftmaxLossAndGradient
```

    ==== Gradient check for naiveSoftmaxLossAndGradient ====
    Gradient check passed!. Read the docstring of the `gradcheck_naive` method in utils.gradcheck.py to understand what the gradient check does.
    Gradient check passed!. Read the docstring of the `gradcheck_naive` method in utils.gradcheck.py to understand what the gradient check does.


## Negative Sampling




* [negative sampling 논문](https://proceedings.neurips.cc/paper/2013/file/9aa42b31882ec039965f3c4923ce901b-Paper.pdf)

Skip-gram은 타겟 단어 C와 컨텍스트 단어 O가 같이 나타나는 확률을 구하기 위해 C와 사전내 모든 어휘들의 내적을 구해야 된다(소프트맥스 함수를 쓰기 때문에). 사전의 크기만큼 전산이 필요하다는 단점을 극복하기 위해 Mikolov가 제시한 방법 중 하나가 **negative sampling**이다.
</br>
Negative sampling은 Noise Contrastive Estimation을 활용한 방식인데, 이는 좋은 모델이라면 노이즈 분포와 원래 데이터 분포를 구별해낼 수 있다는 전제를 기반으로 한다. 예를 들어 원래 데이터셋에 "I like pizza"라는 문장이 있고 타겟 단어가 'like'이며 window 크기가 1일 때, **positive samples**은 (like, I), (like, pizza)이다. 그런데 negative sampling은 (like, towoards)와 같은 negative samples, 즉 노이즈를 일부러 추가하여 모델에게 주어진 샘플이 원래 분포에 속하는지 아니면 노이즈 분포에 속하는지 logistic regression으로 판단하게 한다.


### negative sampling objective
$$
\log\sigma({u_{w_O}}^\top v_{w_C}) + \sum_{i=1}^{k}\mathbb{E}_{w_i\sim P_n{(w)}}[\log \sigma ({-u_{w_i}}^\top v_{w_C})]
$$
<p align='center'> (k는 sampling size, $v$는 $w_C$가 타겟(인풋)일 때의 벡터, $u$는 $w_O$가 컨텍스트일 때의 벡터이다.)</p>

> Note: 벡터 표기법이 논문에 따라 다르다. 지금까지 단어 w의 인풋 벡터는 $V_w$, 컨텍스트 벡터는 $U_w$라고 표기했는데, 아래에서는 각각 $v_{w_C}$, $u_{w_O}$로 표기한다.

> Note: 위 목적함수를 직관적으로 이해하기. $\log\sigma({u_{w_O}}^\top v_{w_C})$는 두 벡터가 유사할수록(내적이 클수록) 0에 수렴한다. 그러나 $\sum_{i=1}^{k}\mathbb{E}_{w_i\sim P_n{(w)}}[\log \sigma ({-u_{w_i}}^\top v_{w_C})]$에서는 두 벡터의 내적(i.e.${-u_{w_i}}^\top v_{w_C}$ )이 클수록 sigmoid 결과값은 0에 수렴하며, 결과적으로 $\log \sigma ({-u_{w_i}}^\top v_{w_C})$ 는 $-\infty$에 수렴한다. 즉 첫 항은 positive pair의 유사도로 maximize해야 하지만 두번째 항은 k개의 negative pairs의 유사도로 minimize해야 한다.

k의 크기는 훈련 데이터셋 크기가 작을 때는 5\~20, 클 때는 2\~5로 충분하다고 한다. 다만 k개의 negative samples을 수집할 때 빈도가 높은 어휘(관사나 전치사 등)가 과수집되는 것을 막기 위해 노이즈 분포를 다음과 같이 정의해준다. 
$$
P_n(w)= \frac{f(w)^{3/4}}{\sum_{i}^{V}f(w_i)^{3/4}}
$$
frequency (Unigram)를 3/4 승하면 노이즈 분포를 완만하게 할 수 있는데, 이는 빈도가 극히 적은 어휘의 확률을 (예를 들어) 0.3에서 $0.405(=0.3^{3/4})$로 올려준다. 

**negative sampling loss and gradient**

skip-gram처럼 목적함수의 negative를 negative sampling의 loss라고 하면
$$
J = -\log\sigma({u_{w_O}}^\top v_{w_C}) - \sum_{i=1}^{k}\mathbb{E}_{w_i\sim P_n{(w)}}[\log \sigma ({-u_{w_i}}^\top v_{w_C})]
$$
이고 따라서 center/target word vector에 대한 미분은

$$
\frac{\partial J}{\partial v_{w_C}} = - \frac{1}{\sigma({u_{w_O}}^\top v_{w_C})} \cdot \sigma({u_{w_O}}^\top v_{w_C}) (1 - \sigma({u_{w_O}}^\top v_{w_C})) \cdot u_{w_O} -\sum_{i=1}^{k} \frac{1}{\sigma(-{u_{w_i}}^\top v_{w_C})} \cdot \sigma(-{u_{w_i}}^\top v_{w_C}) (1-\sigma(-{u_{w_i}}^\top v_{w_C})) \cdot -u_{w_i} \\=(\sigma({u_{w_O}}^\top v_{w_C}) -1)\cdot u_{w_O} + \sum_{i=1}^{k} (1- \sigma(-{u_{w_i}}^\top v_{w_C})) \cdot u_{w_i}
$$

context word vector에 대한 미분은
$$
\frac{\partial J}{\partial u_{w_X}} = - (1 - \sigma({u_{w_O}}^\top v_{w_C})) \cdot \frac{\partial}{\partial u_{w_X}} {u_{w_O}}^\top v_{w_C} - \sum_{i=1}^{k} (1- \sigma(-{u_{w_i}}^\top v_{w_C})) \cdot \frac{\partial}{\partial u_{w_X}} ({-u_{w_i}}^\top v_{w_C})
$$
여기서 $u_{w_X} = u_{w_O}$ 일 때는 (positive sample의 컨텍스트 단어 $w_O$에 대한 미분)
$$
\frac{\partial J}{\partial u_{w_O}} = - (1 - \sigma({u_{w_O}}^\top v_{w_C})) \cdot v_{w_C} 
$$
반면 $u_{w_X} = u_{w_i}$ 일 때는 (즉 negative sample의 컨텍스트 단어 하나에 대한 미분; k만큼 업데이트)
$$
\frac{\partial J}{\partial u_{w_i}} = (1 - \sigma({-u_{w_O}}^\top v_{w_C})) \cdot v_{w_C} (i는 1 \cdots k)
$$
위에서 $u_{w_O} = u_{w_i} $ 즉 컨텍스트 단어 하나가 positive pair와 동시에 negative pair로 추출될 수도 있다. 이때는 위 두식에 의해 두번 업데이트 된다. 



```python
def negSamplingLossAndGradient(
    centerWordVec,
    outsideWordIdx,
    outsideVectors,
    dataset,
    K=10
):
    """ Negative sampling loss function for word2vec models

    Implement the negative sampling loss and gradients for a centerWordVec
    and a outsideWordIdx word vector as a building block for word2vec
    models. K is the number of negative samples to take.

    Note: The same word may be negatively sampled multiple times. For
    example if an outside word is sampled twice, you shall have to
    double count the gradient with respect to this word. Thrice if
    it was sampled three times, and so forth.

    Arguments/Return Specifications: same as naiveSoftmaxLossAndGradient
    """

    # Negative sampling of words is done for you. Do not modify this if you
    # wish to match the autograder and receive points!
    negSampleWordIndices = getNegativeSamples(outsideWordIdx, dataset, K)
    indices = [outsideWordIdx] + negSampleWordIndices

    ### YOUR CODE HERE (~10 Lines)

    ### Please use your implementation of sigmoid in here.
    gradOutsideVecs = np.zeros(outsideVectors.shape) # (V, D)
    z = np.dot(outsideVectors[outsideWordIdx], centerWordVec) # (D,) @ (D,) -> 1 
    probs = sigmoid(z) # plain skip-gram에서는 softmax

    loss = - np.log(probs)
    gradCenterVec = (probs-1) * outsideVectors[outsideWordIdx] 
    gradOutsideVecs[outsideWordIdx] = (probs-1.) * centerWordVec # (D,); update gradient of the context vector for the positive pair

    for i in range(K):
        idx = negSampleWordIndices[i]
        probs_neg = sigmoid(-np.dot(outsideVectors[idx], centerWordVec))
        loss -= np.log(probs_neg)
        gradCenterVec -= (probs_neg-1) * outsideVectors[idx]
        gradOutsideVecs[idx] += (1-probs_neg) * centerWordVec # update gradient of the context vector for each positive pair

    ### END YOUR CODE

    return loss, gradCenterVec, gradOutsideVecs
```


```python
#hide
!python word2vec.py negSamplingLossAndGradient
```

    ==== Gradient check for negSamplingLossAndGradient ====
    Gradient check passed!. Read the docstring of the `gradcheck_naive` method in utils.gradcheck.py to understand what the gradient check does.
    Gradient check passed!. Read the docstring of the `gradcheck_naive` method in utils.gradcheck.py to understand what the gradient check does.



```python
#hide
!python word2vec.py skipgram
```

    ==== Gradient check for skip-gram with naiveSoftmaxLossAndGradient ====
    Gradient check passed!. Read the docstring of the `gradcheck_naive` method in utils.gradcheck.py to understand what the gradient check does.
    ======Skip-Gram with naiveSoftmaxLossAndGradient Test Cases======
    The first test passed!
    The second test passed!
    The third test passed!
    All 3 tests passed!
    ==== Gradient check for skip-gram with negSamplingLossAndGradient ====
    Gradient check passed!. Read the docstring of the `gradcheck_naive` method in utils.gradcheck.py to understand what the gradient check does.
    ======Skip-Gram with negSamplingLossAndGradient======
    The first test passed!
    The second test passed!
    The third test passed!
    All 3 tests passed!

